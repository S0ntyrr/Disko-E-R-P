@model DiskoERP.Core.DTOs.LoginDto
@{
    Layout = "_LoginLayout";
    ViewData["Title"] = "Iniciar Sesión";
}

<div class="login-container">
    <div class="login-box">
        <!-- Logo y título -->
        <div class="login-header">
            <div class="logo-container">
                <i class="fas fa-music logo-icon"></i>
            </div>
            <h1 class="brand-title">Disko ERP</h1>
            <p class="brand-subtitle">Sistema de Gestión para Discotecas</p>
        </div>

        <!-- Mensajes de alerta -->
        @if (TempData["Error"] != null)
        {
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="fas fa-exclamation-circle"></i>
                @TempData["Error"]
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        }

        @if (TempData["Success"] != null)
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <i class="fas fa-check-circle"></i>
                @TempData["Success"]
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        }

        <!-- Formulario de login -->
        <form asp-action="Login" asp-controller="Auth" method="post" id="loginForm" class="login-form">
            
            <input type="hidden" name="returnUrl" value="@ViewData["ReturnUrl"]" />

            <!-- Campo Usuario -->
            <div class="form-group mb-3">
                <label asp-for="Usuario" class="form-label">
                    <i class="fas fa-user"></i> Usuario o Email
                </label>
                <input asp-for="Usuario" 
                       class="form-control form-control-lg" 
                       placeholder="Ingresa tu usuario o email"
                       autofocus
                       autocomplete="username" />
                <span asp-validation-for="Usuario" class="text-danger small"></span>
            </div>

            <!-- Campo Contraseña -->
            <div class="form-group mb-3">
                <label asp-for="Password" class="form-label">
                    <i class="fas fa-lock"></i> Contraseña
                </label>
                <div class="password-input-group">
                    <input asp-for="Password" 
                           type="password" 
                           class="form-control form-control-lg" 
                           id="passwordInput"
                           placeholder="Ingresa tu contraseña"
                           autocomplete="current-password" />
                    <button type="button" class="btn-toggle-password" id="togglePassword">
                        <i class="fas fa-eye" id="toggleIcon"></i>
                    </button>
                </div>
                <span asp-validation-for="Password" class="text-danger small"></span>
            </div>

            <!-- Recordar sesión -->
            <div class="form-check mb-3">
                <input asp-for="RecordarSesion" 
                       type="checkbox" 
                       class="form-check-input" 
                       id="recordarSesion" />
                <label class="form-check-label" for="recordarSesion">
                    Recordar mi sesión
                </label>
            </div>

            <!-- Información de usuario demo -->
            <div class="alert alert-info mb-3">
                <small>
                    <strong>Usuario Demo:</strong> admin<br>
                    <strong>Contraseña:</strong> 123456
                </small>
            </div>

            <!-- Botón de login -->
            <button type="submit" class="btn btn-primary btn-lg w-100 mb-3" id="btnLogin">
                <span class="btn-text">
                    <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                </span>
                <span class="spinner-border spinner-border-sm d-none" role="status" id="loginSpinner"></span>
            </button>

            <!-- Link recuperar contraseña -->
            <div class="text-center">
                <a asp-action="RecuperarPassword" asp-controller="Auth" class="forgot-password-link">
                    ¿Olvidaste tu contraseña?
                </a>
            </div>
        </form>

        <!-- Footer del login -->
        <div class="login-footer">
            <p class="text-muted small mb-0">
                <i class="fas fa-shield-alt"></i> Acceso seguro protegido
            </p>
        </div>
    </div>

    <!-- Información adicional (solo en pantallas grandes) -->
    <div class="login-info d-none d-lg-block">
        <div class="info-content">
            <h2 class="info-title">
                <i class="fas fa-chart-line"></i>
                Gestiona tu Discoteca de Forma Profesional
            </h2>
            <ul class="info-list">
                <li><i class="fas fa-check-circle"></i> Control de entrada y aforo en tiempo real</li>
                <li><i class="fas fa-check-circle"></i> Gestión de reservaciones VIP</li>
                <li><i class="fas fa-check-circle"></i> Sistema de punto de venta integrado</li>
                <li><i class="fas fa-check-circle"></i> Reportes y estadísticas detalladas</li>
                <li><i class="fas fa-check-circle"></i> Control de inventario y personal</li>
            </ul>
        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/login.css" />
}

@section Scripts {
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Script específico para esta página
        document.addEventListener('DOMContentLoaded', function() {
            // Toggle password visibility
            const togglePassword = document.getElementById('togglePassword');
            const passwordInput = document.getElementById('passwordInput');
            const toggleIcon = document.getElementById('toggleIcon');

            if (togglePassword && passwordInput) {
                togglePassword.addEventListener('click', function() {
                    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordInput.setAttribute('type', type);
                    
                    if (type === 'password') {
                        toggleIcon.classList.remove('fa-eye-slash');
                        toggleIcon.classList.add('fa-eye');
                    } else {
                        toggleIcon.classList.remove('fa-eye');
                        toggleIcon.classList.add('fa-eye-slash');
                    }
                });
            }

            // Validación del formulario
            const form = document.getElementById('loginForm');
            const usuarioInput = document.querySelector('input[name="Usuario"]');
            const passwordInput = document.querySelector('input[name="Password"]');
            const btnLogin = document.getElementById('btnLogin');

            // Validar campos vacíos antes de enviar
            form.addEventListener('submit', function(e) {
                let isValid = true;

                // Validar usuario
                if (!usuarioInput.value.trim()) {
                    e.preventDefault();
                    mostrarError(usuarioInput, 'El usuario es requerido');
                    isValid = false;
                }

                // Validar contraseña
                if (!passwordInput.value) {
                    e.preventDefault();
                    mostrarError(passwordInput, 'La contraseña es requerida');
                    isValid = false;
                }

                if (isValid) {
                    // Mostrar spinner
                    btnLogin.querySelector('.btn-text').classList.add('d-none');
                    document.getElementById('loginSpinner').classList.remove('d-none');
                    btnLogin.disabled = true;
                }
            });

            // Función para mostrar errores
            function mostrarError(input, mensaje) {
                const errorSpan = input.nextElementSibling;
                if (errorSpan && errorSpan.classList.contains('text-danger')) {
                    errorSpan.textContent = mensaje;
                    input.classList.add('is-invalid');
                }
            }

            // Limpiar errores al escribir
            [usuarioInput, passwordInput].forEach(input => {
                input.addEventListener('input', function() {
                    this.classList.remove('is-invalid');
                    const errorSpan = this.nextElementSibling;
                    if (errorSpan && errorSpan.classList.contains('text-danger')) {
                        errorSpan.textContent = '';
                    }
                });
            });

            // Auto-dismiss alerts después de 5 segundos
            setTimeout(() => {
                const alerts = document.querySelectorAll('.alert');
                alerts.forEach(alert => {
                    if (alert.classList.contains('alert-dismissible')) {
                        alert.style.animation = 'slideUp 0.3s ease-out forwards';
                        setTimeout(() => alert.remove(), 300);
                    }
                });
            }, 5000);
        });
    </script>
}

<a href="/Auth/Register" class="btn btn-secondary">Crear usuario</a>
